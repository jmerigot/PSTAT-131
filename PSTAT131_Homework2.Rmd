---
title: "Homework 2"
author: "Jules Merigot (8488256)"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output: pdf_document
---

```{r setup, echo=FALSE, include=FALSE}
library(ggplot2)
library(tidyverse)
library(tidymodels)
library(ISLR)
library(corrplot)
library(ggthemes)
tidymodels_prefer()

library(knitr)
# set global chunk options: images will be 7x5 inches
knitr::opts_chunk$set(fig.width=7, fig.height=5)
options(digits = 4)

## indents are for indenting r code as formatted text
## They may need to be adjusted depending on your OS
# if your output looks odd, increase or decrease indent
indent1 = '    '
indent2 = '        '
indent3 = '            '

aba_data <- read.csv(file = "C:/Users/jules/OneDrive/Desktop/PSTAT-131/data/abalone.csv")
```

\begin{center}
PSTAT 131/231 Statistical Machine Learning - Fall 2022
\end{center}

# Linear Regression

## Question 1

```{r}
# Adding the age variable as a column to the Abalone data frame
abalones <- aba_data %>%
  mutate(age = rings + 1.5)

# Checking to see it was correctly added
head(abalones)

# Making a histogram of the age in order to asses the distribution
hist(abalones$age)
```

Using a histogram, we can see that the age of the abalones is normally distributed and skewed right, with an average age of about 11 years old. While there are more outliers that are older in age, most abalones tend to live between 5 and 15 years.

## Question 2

```{r}
set.seed(8488)

abalones_split <- initial_split(abalones, prop=0.80, strata=age)

abalones_train <- training(abalones_split)
abalones_test <- testing(abalones_split)
```

## Question 3

I shouldn't include *rings* in the recipe to predict *age* since the *age* variable was calculated and added to the abalones dataset using the *rings* variable. As done in Question 1, we copied the *rings* column and added 1.5 in order to create the *age* column.

```{r, results='hide'}
abalones_recipe <- recipe(age ~ ., data=abalones_train) %>%
  step_rm(rings) %>% # removing rings variable
  step_dummy(all_nominal_predictors()) %>% # Step 1: dummy code categorical predictors
  step_interact(terms = ~ type_M:shucked_weight) %>% # Step 2: creating interactions
  step_interact(terms = ~ type_I:shucked_weight) %>%
  step_interact(terms = ~ longest_shell:diameter) %>%
  step_interact(terms = ~ shucked_weight:shell_weight) %>%
  step_center(all_predictors()) %>% # Step 3: centering predictors
  step_scale(all_predictors()) # Step 4: scaling predictors
abalones_recipe
```

## Question 4

```{r}
lm_model <- linear_reg() %>% 
  set_engine("lm")
```

## Question 5

```{r}
lm_wflow <- workflow() %>% 
  add_model(lm_model) %>% 
  add_recipe(abalones_recipe)
```

## Question 6

```{r}
lm_fit <- fit(lm_wflow, abalones_train)

lm_fit %>% 
  # This returns the parsnip object:
  extract_fit_parsnip() %>% 
  # Now tidy the linear model object:
  tidy()
```